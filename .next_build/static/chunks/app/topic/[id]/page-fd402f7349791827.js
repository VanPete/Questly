(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[96],{1899:(e,t,n)=>{"use strict";n.d(t,{default:()=>p});var i=n(5155),r=n(2115),a=n(2973);let s={tides:{quick:{q:"What mainly causes tides on Earth?",options:["Wind patterns","Moon’s gravity","Earth’s rotation","Ocean currents"],correct_index:1},quiz:[{q:"High tides are highest during which phase?",options:["Quarter","New/Full (spring)","Gibbous","Crescent"],correct_index:1},{q:"Neap tides occur when the Sun and Moon are...",options:["Aligned","At right angles","Both new","Both full"],correct_index:1},{q:"Which body has the bigger tidal effect?",options:["Sun","Moon","They are equal","Jupiter"],correct_index:1},{q:"How many high tides per day at most coasts?",options:["1","2","3","Varies randomly"],correct_index:1},{q:"A practical safety tip around tides?",options:["Ignore forecasts","Check local tables","Swim at night","Tides are the same everywhere"],correct_index:1}]},maps:{quick:{q:"Mercator projection preserves...",options:["Area","Shape and bearings","Distances","None of the above"],correct_index:1},quiz:[{q:"Equal-area maps preserve...",options:["Shape","Area","Bearings","Scale everywhere"],correct_index:1},{q:"Greenland appears huge on Mercator because...",options:["It is huge","High-latitude stretching","Data error","Political bias only"],correct_index:1},{q:"Which is best for navigation bearings?",options:["Mercator","Equal-area","Gnomonic","Orthographic"],correct_index:0},{q:"No flat map can perfectly preserve...",options:["Area only","Shape only","All properties","Bearings only"],correct_index:2},{q:"Modern GIS often uses...",options:["Single universal proj","Projection per purpose","Only 3D globes","No projections"],correct_index:1}]},"roman-legions":{quick:{q:"A Roman legion was roughly...",options:["500 men","1,000 men","5,000 men","20,000 men"],correct_index:2},quiz:[{q:"Early maniples evolved into...",options:["Cohorts","Phalanx","Centuries","Triarii"],correct_index:0},{q:"A centurion was...",options:["Cavalry officer","Infantry commander","Quartermaster","Auxiliary"],correct_index:1},{q:"Key legion strength was...",options:["Chariots","Discipline and logistics","Elephants","Archers"],correct_index:1},{q:"Marching camps provided...",options:["Festivals","Daily fortification","Worship","None"],correct_index:1},{q:"Legacy of legions on modern armies?",options:["No impact","Professionalization","Only weapon tech","Cavalry focus"],correct_index:1}]}};var o=n(7260);let l=()=>new Date().toISOString().slice(0,10);function c(e){let{topic:t}=e,[n,c]=(0,r.useState)("intro"),d=s[t.id],[u,p]=(0,r.useState)(null),[h,m]=(0,r.useState)([]);(0,r.useEffect)(()=>{let e=!1;return(async()=>{try{let n=await fetch("/api/questions/generate",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({topic:t})}),i=n.ok?await n.json():d;if(e)return;p(i.quick||(null==d?void 0:d.quick)||{q:"Warmup?",options:["A","B","C","D"],correct_index:1}),m((i.quiz||(null==d?void 0:d.quiz)||[]).slice(0,5))}catch(t){if(e)return;p((null==d?void 0:d.quick)||{q:"Warmup?",options:["A","B","C","D"],correct_index:1}),m(((null==d?void 0:d.quiz)||[]).slice(0,5))}})(),()=>{e=!0}},[t,d]);let[x,b]=(0,r.useState)(0),[f,g]=(0,r.useState)(null),[y,j]=(0,r.useState)(!1),[v,N]=(0,r.useState)(!1),[w,k]=(0,r.useState)(null),_=(0,o.useRouter)(),q=e=>{u&&(p({...u,chosen_index:e}),(0,a.u4)("quickq_answered",{topicId:t.id,correct:e===u.correct_index}),c("quiz"))},S=async()=>{let e=h.map(e=>{var t;return{...e,chosen_index:null!=(t=e.chosen_index)?t:-1}}),n=e.filter(e=>e.chosen_index===e.correct_index).length;b(n),(0,a.u4)("quiz_completed",{topicId:t.id,score:n,total:e.length}),N(!0),k(null);try{if(!(await fetch("/api/quiz",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({topic_id:t.id,questions:e})})).ok)throw Error("Failed to save quiz");let i=await fetch("/api/progress",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({date:l(),topic_id:t.id,quick_correct:!!u&&u.chosen_index===u.correct_index,quiz_score:n,quiz_total:e.length,completed:!0})}),r=i.ok?await i.json():{points_gained:0,bonus:0,multiplier:1};g({gained:r.points_gained,bonus:r.bonus,multiplier:r.multiplier,streak:r.streak}),c("summary")}catch(e){k("Could not save your progress. Please try again.")}finally{N(!1)}};return u&&0!==h.length?"intro"===n?(0,i.jsxs)("section",{children:[(0,i.jsx)("h2",{className:"text-2xl font-semibold mb-2",children:t.title}),(0,i.jsx)("p",{className:"opacity-80 mb-4",children:t.blurb}),(0,i.jsx)("button",{className:"px-4 py-2 rounded bg-black text-white",onClick:()=>c("quick"),children:"Start"})]}):"quick"===n?(0,i.jsxs)("section",{"aria-labelledby":"quick-question-title",children:[(0,i.jsx)("h3",{id:"quick-question-title",className:"font-semibold mb-2",children:"Quick Question"}),(0,i.jsx)("p",{className:"mb-3",children:u.q}),(0,i.jsx)("div",{className:"grid gap-2",role:"radiogroup","aria-label":"Quick question options",children:u.options.map((e,t)=>(0,i.jsx)("button",{onClick:()=>q(t),tabIndex:0,"aria-pressed":u.chosen_index===t,"aria-label":e,className:"border rounded px-3 py-2 text-left hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-amber-500 focus:border-amber-500 ".concat(u.chosen_index===t?"bg-amber-400 text-black":""),onKeyDown:e=>{("Enter"===e.key||" "===e.key)&&(e.preventDefault(),q(t))},children:e},t))})]}):"quiz"===n?(0,i.jsxs)("section",{"aria-labelledby":"mini-quiz-title",children:[(0,i.jsx)("h3",{id:"mini-quiz-title",className:"font-semibold mb-2",children:"Mini Quiz (5)"}),w&&(0,i.jsx)("div",{className:"text-red-600 mb-2",role:"alert",children:w}),h.map((e,t)=>(0,i.jsxs)("div",{className:"mb-3",children:[(0,i.jsx)("p",{className:"mb-1",children:e.q}),(0,i.jsx)("div",{className:"grid gap-2",role:"radiogroup","aria-label":"Quiz question ".concat(t+1," options"),children:e.options.map((n,r)=>(0,i.jsx)("button",{onClick:()=>{let n=[...h];n[t]={...e,chosen_index:r},m(n)},tabIndex:0,"aria-pressed":e.chosen_index===r,"aria-label":n,className:"border rounded px-3 py-2 text-left hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-amber-500 focus:border-amber-500 ".concat(e.chosen_index===r?"bg-amber-400 text-black border-black":""),onKeyDown:n=>{if("Enter"===n.key||" "===n.key){n.preventDefault();let i=[...h];i[t]={...e,chosen_index:r},m(i)}},children:n},r))})]},t)),(0,i.jsx)("button",{className:"mt-2 px-4 py-2 rounded bg-black text-white disabled:opacity-60 focus:outline-none focus:ring-2 focus:ring-amber-500 focus:border-amber-500",onClick:S,disabled:v,tabIndex:0,children:"Submit"})]}):"summary"===n?(0,i.jsxs)("section",{children:[(0,i.jsx)("h3",{className:"font-semibold mb-2",children:"Summary & Review"}),(0,i.jsxs)("div",{className:"flex flex-wrap gap-2 mb-2",children:[x===h.length&&(0,i.jsx)("span",{className:"inline-flex items-center gap-1 px-3 py-1 rounded-full bg-green-100 text-green-800 text-xs font-semibold border border-green-300",children:"\uD83C\uDFC6 Perfect Score!"}),x>=Math.ceil(.8*h.length)&&x<h.length&&(0,i.jsx)("span",{className:"inline-flex items-center gap-1 px-3 py-1 rounded-full bg-blue-100 text-blue-800 text-xs font-semibold border border-blue-300",children:"\uD83C\uDFAF Great Score"}),(null==f?void 0:f.streak)&&f.streak>1&&(0,i.jsxs)("span",{className:"inline-flex items-center gap-1 px-3 py-1 rounded-full bg-amber-100 text-amber-800 text-xs font-semibold border border-amber-300",children:["\uD83D\uDD25 Streak ",f.streak]})]}),(0,i.jsxs)("p",{className:"mb-2",children:["Score: ",x," / ",h.length]}),Array.isArray(t.angles)&&t.angles.length>0&&(0,i.jsxs)("div",{className:"mb-3",children:[(0,i.jsx)("div",{className:"font-semibold",children:"Key facts"}),(0,i.jsx)("ul",{className:"list-disc pl-5 opacity-90",children:t.angles.map((e,t)=>(0,i.jsx)("li",{children:e},t))})]}),(0,i.jsx)("div",{className:"mb-3 space-y-2",children:h.map((e,t)=>{var n,r;let a=e.chosen_index===e.correct_index;return(0,i.jsxs)("div",{className:"p-2 rounded border ".concat(a?"border-green-600":"border-amber-600"),children:[(0,i.jsxs)("div",{className:"font-medium",children:["Q",t+1,". ",e.q]}),(0,i.jsxs)("div",{className:"text-sm",children:["Your answer: ",null!=(r=e.options[null!=(n=e.chosen_index)?n:-1])?r:"—",a?"":" (correct: ".concat(e.options[e.correct_index],")")]})]},t)})}),f&&(0,i.jsxs)("p",{className:"mb-2",children:["Points +",f.gained," (bonus ",f.bonus,", x",f.multiplier.toFixed(2),f.streak?", Streak ".concat(f.streak):"",")"]}),(0,i.jsx)("div",{className:"mb-3",children:(0,i.jsx)("button",{className:"px-3 py-2 rounded border text-sm",onClick:async()=>{let e=h.map(e=>e.chosen_index===e.correct_index?"\uD83D\uDFE9":"\uD83D\uDFE5").join(""),n=u&&void 0!==u.chosen_index?u.chosen_index===u.correct_index?"✅":"❌":"",i=l(),r=window.location.origin||"https://thequestly.com",s="Questly • ".concat(t.title,"\nDate: ").concat(i,"\nQuick: ").concat(n,"\nQuiz: ").concat(x,"/").concat(h.length,"\n").concat(e,"\n").concat(r);try{await navigator.clipboard.writeText(s),j(!0),(0,a.u4)("share_copied",{topicId:t.id,score:x,total:h.length}),setTimeout(()=>j(!1),1500)}catch(e){}},children:y?"Copied!":"Share result"})}),(0,i.jsxs)("div",{className:"mb-3 text-sm opacity-80",children:["Learn more:"," ",(0,i.jsx)("a",{className:"underline",href:"https://en.wikipedia.org/wiki/Special:Search?search=".concat(encodeURIComponent(t.title)),target:"_blank",rel:"noreferrer",children:"Wikipedia"})," \xb7 ",(0,i.jsx)("a",{className:"underline",href:"https://www.google.com/search?q=".concat(encodeURIComponent(t.title)),target:"_blank",rel:"noreferrer",children:"Web"})]}),(0,i.jsxs)("div",{className:"flex gap-2",children:[(0,i.jsx)("button",{className:"px-4 py-2 rounded border",onClick:()=>c("chat"),children:"Chat to Explore More"}),(0,i.jsx)("button",{className:"px-4 py-2 rounded border",onClick:()=>_.push("/daily"),children:"Back to Daily"})]})]}):(0,i.jsx)("section",{children:(0,i.jsx)("p",{className:"mb-3",children:"Open the chat in the topic page below."})}):(0,i.jsx)("div",{className:"opacity-70",children:"Loading questions…"})}function d(e){let{onAction:t}=e,n="px-3 py-2 rounded-xl border text-sm hover:bg-neutral-50 dark:hover:bg-neutral-900";return(0,i.jsxs)("div",{className:"flex flex-wrap gap-2 mt-2",children:[(0,i.jsx)("button",{className:n,onClick:()=>t("summary"),children:"Summarize"}),(0,i.jsx)("button",{className:n,onClick:()=>t("plan"),children:"7‑day plan"}),(0,i.jsx)("button",{className:n,onClick:()=>t("quiz"),children:"Quiz me (5)"}),(0,i.jsx)("button",{className:n,onClick:()=>t("examples"),children:"Give examples"})]})}function u(e){var t;let{topic:n}=e,[s,l]=(0,r.useState)([]),[c,u]=(0,r.useState)(""),[p,h]=(0,r.useState)(!1),m=(0,r.useRef)(null),[x,b]=(0,r.useState)(null),[f,g]=(0,r.useState)("free"),y=(0,o.useRouter)(),j=s.filter(e=>"user"===e.role).length,v="premium"===f?1/0:5,N=j>=v;async function w(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"explore";if(N)return;if(0===s.length){(0,a.u4)("chat_start",{topicId:n.id});try{let e=await fetch("/api/conversations",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({topic_id:n.id,title:n.title})}),t=await e.json();e.ok&&t.id&&b(t.id)}catch(e){}}h(!0);let i=await fetch("/api/chat",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({topic:n,messages:s,content:e,mode:t})}),r={};try{r=await i.json()}catch(e){}if(!i.ok||!r.reply){l(t=>[...t,{role:"user",content:e},{role:"assistant",content:"Sorry, I had trouble responding. Please try again."}]),u(""),h(!1);return}let o=r.reply;if(l(t=>[...t,{role:"user",content:e},{role:"assistant",content:o}]),x)try{await fetch("/api/messages",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({conversation_id:x,role:"user",content:e})}),await fetch("/api/messages",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({conversation_id:x,role:"assistant",content:o})})}catch(e){}u(""),h(!1),setTimeout(()=>{var e;return null==(e=m.current)?void 0:e.scrollTo({top:m.current.scrollHeight,behavior:"smooth"})},50)}return(0,r.useEffect)(()=>{fetch("/api/subscription").then(e=>e.json()).then(e=>g("premium"===e.plan?"premium":"free")).catch(()=>{})},[]),(0,r.useEffect)(()=>{(0,a.u4)("chat_opened",{topicId:n.id})},[]),(0,i.jsxs)("div",{className:"mt-4",children:[(0,i.jsxs)("div",{ref:m,className:"space-y-3 max-h-[60vh] overflow-y-auto rounded-2xl p-3 bg-white/60 dark:bg-neutral-900/50 border",children:[(0,i.jsxs)("div",{className:"text-sm opacity-80",children:[(0,i.jsx)("p",{className:"mb-2",children:n.seedContext}),(0,i.jsx)("ul",{className:"list-disc ml-6",children:null==(t=n.angles)?void 0:t.map((e,t)=>(0,i.jsx)("li",{children:e},t))})]}),s.map((e,t)=>(0,i.jsxs)("div",{className:"p-3 rounded-2xl ".concat("user"===e.role?"bg-neutral-100 dark:bg-neutral-800":"bg-emerald-50 dark:bg-emerald-900/30"),children:[(0,i.jsx)("div",{className:"text-xs opacity-60 mb-1",children:e.role}),(0,i.jsx)("div",{className:"whitespace-pre-wrap text-sm",children:e.content})]},t))]}),(0,i.jsx)(d,{onAction:e=>{(0,a.u4)("action_click",{action:e,topicId:n.id}),"summary"===e&&w("Summarize so far","summary"),"plan"===e&&w("Create a 7-day micro-learning plan (20–30 min/day).","plan"),"quiz"===e&&w("Quiz me with 5 questions and hide answers until the end.","quiz"),"examples"===e&&w("Give 3 real-world examples/applications.","examples")}}),"free"===f&&(0,i.jsxs)("div",{className:"mt-2 text-xs opacity-80",children:["Free chat limit: ",j,"/",isFinite(v)?v:0,". ",N?(0,i.jsx)("button",{onClick:()=>y.push("/upgrade"),className:"underline",children:"Upgrade for unlimited chat"}):""]}),(0,i.jsxs)("form",{className:"mt-3 flex gap-2",onSubmit:e=>{if(e.preventDefault(),N)return void y.push("/upgrade");!p&&c.trim()&&w(c,"explore")},children:[(0,i.jsx)("input",{className:"flex-1 px-3 py-2 rounded-xl border bg-white dark:bg-neutral-900",value:c,onChange:e=>u(e.target.value),placeholder:"Ask about this topic…"}),N?(0,i.jsx)("button",{type:"button",onClick:()=>y.push("/upgrade"),className:"px-4 py-2 rounded-xl border font-medium",children:"Upgrade"}):(0,i.jsx)("button",{disabled:p,className:"px-4 py-2 rounded-xl border font-medium",children:p?"…":"Send"})]})]})}function p(e){let{topic:t}=e;return(0,r.useEffect)(()=>{t&&(0,a.u4)("topic_view",{topicId:t.id})},[t]),(0,i.jsxs)("main",{className:"space-y-6",children:[(0,i.jsx)(c,{topic:t}),(0,i.jsxs)("div",{children:[(0,i.jsx)("h4",{className:"font-semibold mb-2",children:"Chat"}),(0,i.jsx)(u,{topic:t})]})]})}},2973:(e,t,n)=>{"use strict";function i(){return"undefined"!=typeof window}n.d(t,{u4:()=>s});function r(){return(i()?window.vam:function(){return"production"}())||"production"}function a(){return"production"===r()}function s(e,t,n){var s,o;if(!i()){let e="[Vercel Web Analytics] Please import `track` from `@vercel/analytics/server` when using this function in a server environment";if(a())console.warn(e);else throw Error(e);return}if(!t){null==(s=window.va)||s.call(window,"event",{name:e,options:n});return}try{let i=function(e,t){if(!e)return;let n=e,i=[];for(let[r,a]of Object.entries(e))"object"==typeof a&&null!==a&&(t.strip?n=function(e,{[e]:t,...n}){return n}(r,n):i.push(r));if(i.length>0&&!t.strip)throw Error(`The following properties are not valid: ${i.join(", ")}. Only strings, numbers, booleans, and null are allowed.`);return n}(t,{strip:a()});null==(o=window.va)||o.call(window,"event",{name:e,data:i,options:n})}catch(e){e instanceof Error&&"development"===r()&&console.error(e)}}},5702:(e,t,n)=>{Promise.resolve().then(n.bind(n,1899))}},e=>{e.O(0,[441,493,358],()=>e(e.s=5702)),_N_E=e.O()}]);