# Questly Roadmap (v1)

## Vision
- One-sentence value: Learn a little every day through quick quizzes and concise summaries, with points and leaderboards to keep it fun.
- Personas: All ages, tech-savvy; desktop-first (mobile polished next).

## Core Loop (Daily)
- Topic → 5-question Quiz → Short Summary → Points → Leaderboard.
- Daily reset at 00:00 EST (America/New_York, honor DST).

## Access Tiers
- Anonymous: Can play, see summaries. No leaderboard/points persistence.
- Free (signed in): 1 quiz per difficulty (Beginner/Intermediate/Advanced) per day → 3 daily quests.
- Premium (v1): 2 quizzes per difficulty per day (total 6), 10 chats/day, no ads. Price: $10/month.
- Nothing is hard paywalled; premium adds “more”.

## Content
- Curated topics from `Topics.csv`; target 12 domains × 30 items per difficulty.
- Daily rotation chooses per-difficulty quests from curated pool.

## Quiz & Chat
- Quiz: 5 questions, no time limit.
- Chat: 3 free chats/day; resets at daily quest rollover; premium = 10/day.
- Safety: limit responses to concise, reasonable explanations (no verbose essays).

## Scoring & Leaderboards
- Per difficulty max: 10 points. Daily totals: Free 30 (3 quizzes), Premium 60 (6 quizzes).
- Scoring curve: reward more correct with non-linear scaling, e.g., score = round(10 * (correct/5)^1.5).
- Leaderboards: Daily and Lifetime (streak later).

## Auth & Profile
- Providers: Google, Microsoft, Apple, Email.
- Display name required and unique (case-insensitive), preserved on guest→user migration.

## Operations & Analytics
- Environments: prod-only now; add dev/staging later.
- Logging/monitoring: Supabase + Vercel logs.
- Backups/restore: default Supabase for now; formal RPO/RTO later.
- KPIs (later): DAU, D7 retention, quiz completion, streak length, conversion.

---

## v1 Product Spec (implement now)
1) Daily Quests
- At 00:00 EST rotate to the next 1 (free) or 2 (premium) quests per difficulty.
- Anonymous can play but results don’t persist; signed-in users earn points.
- Acceptance:
  - Rotation occurs within 2 minutes of 00:00 EST.
  - Free users see exactly 3 quests; Premium see 6.
  - Anonymous can complete a quiz and view answers.

2) Quiz Flow
- 5 questions; submit → server calculates score; client renders concise summary.
- Acceptance:
  - POST /api/quiz returns attempt, total, score, and answers for review.
  - Summary renders 2–3 crisp takeaways; “Back to Quests” shown.

3) Points
- Use non-linear curve per difficulty; cap at 10.
- Update user_points on completion; reflect in header/profile; show banner on mobile.
- Acceptance:
  - POST /api/progress returns points_gained; total_points updates.
  - Daily total caps at 30 (free) and 60 (premium).

4) Leaderboards
- Daily and Lifetime views.
- Acceptance:
  - Daily shows today’s standings; Lifetime shows cumulative.

5) Chat Limits
- Free: 3/day; Premium: 10/day; resets with daily quests.
- Acceptance:
  - Counter decreases per send; resets at rollover; premium threshold respected.

6) Auth & Profile
- Social providers enabled; unique display names enforced.
- Acceptance:
  - Signup prompts for display name; duplicates blocked with friendly error.
  - Guest progress is preserved after signup.

---

## 2-Week Engineering Plan
(Assumes current Next.js + Supabase repo.)

Week 1
- D1: Topics import
  - Parse `Topics.csv`; seed into DB with domain + difficulty tags; idempotent script.
- D2: Rotation at 00:00 EST
  - Ensure `daily_topics` holds 1 (free) and 2 (premium) per difficulty; timezone-aware.
  - Optional: Vercel cron calling admin rotate endpoint daily.
- D3: Scoring function
  - Implement curve (power 1.5) with max 10 per difficulty; tests for 0–5 correct.
- D4: Points caps & premium eligibility
  - Enforce per-day caps (30/60). Check plan in `user_subscriptions`.
- D5: Display name uniqueness
  - DB unique index; API validation; UI error messaging.

Week 2
- D6: Leaderboards polish
  - Daily + Lifetime UI; confirm RLS; snapshot consistency.
- D7: Chat quota
  - Enforce per-day counters per plan; UI badges; reset on rollover.
- D8: Anonymous→user migration
  - Tie local progress to account upon signup (server reconciliation by cookie/token).
- D9: Mobile optimizations
  - Sticky points banner; summary layout; small-screen spacing.
- D10: QA + Launch checklist
  - Happy-path + edge cases; seed check; security advisor clear; README updates.

---

## Technical Notes
- Timezone: use America/New_York for rollover (DST-safe), not fixed UTC offsets.
- RLS: use `(SELECT auth.uid())` in USING/WITH CHECK to avoid initplan perf hits.
- Backfill: idempotent SQL already added for profiles/user_points.

## Follow-ups Needed
1) Confirm America/New_York for daily rollover (cron will call rotate endpoint at 00:00 EST).
2) Finalize whether to store curated topics in `topics_raw` vs. a dedicated `topics` table.
3) Provide Stripe product/price IDs for $10/month (annual later?).
4) Social login app credentials (Google, Microsoft, Apple) readiness.
5) Display name uniqueness: approve case-insensitive 3–24 chars.
6) Leaderboard snapshot strategy: live query vs scheduled snapshot.
